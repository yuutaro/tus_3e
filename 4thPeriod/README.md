## 課題内容

以下の課題内容をプログラムとレポートの内容を総合的に判断して採点を行います．

プログラムが課題内容を満たしていることが前提ですが，レポートで自分が理解をしていることを十分にアピールしてください．

### **１．動画の読み込み**（最大10点）

動画（People - 84973.mp4）を読み込み，  動画の縦・横のサイズ，FPS，総フレーム数を出力してください．

### **２．サムネイル画像の作成**（最大10点）

サムネイルとして動画（People - 84973.mp4）中のフレーム画像を１枚出力し，保存してください．

<aside>
⚠️ 保存する画像のファイル名は 学籍番号_People_thumb.jpgとしてください

</aside>

### **３．ファイル名のパース**（最大10点）

動画のファイル名（People - 84973.mp4）の文字列を処理して，タイトル（People）とID（84973）に分けるプログラムを作成し，その結果を出力してください．

<aside>
⚠️ この課題では "People - 84973.mp4" の文字列をプログラム内に直接書いても良いですが，"Cat - 66004.mp4" など他の動画の場合でも同様のアルゴリズムでタイトルとIDに分けられるようにしてください

</aside>

ファイル名 People - 84973.mp4 の出力結果例

<aside>
📤 Title:  People 
ID:  84973

</aside>

ファイル名 Cat - 66004.mp4 の出力結果例

<aside>
📤 Title:  Cat 
ID:  66004

</aside>

### ４．二値化と動画の保存（最大10点）

動画（Cat - 66004.mp4）を２値化した動画を作成するプログラムを作成し，その動画を保存してください．閾値は自分で設定してかまいません．

二値化：画素値が閾値より大きければ白を割り当て，そうでなければ黒を割り当てる処理

<aside>
⚠️ 縦・横のサイズは元のサイズからそれぞれ 0.3倍 してください

</aside>

<aside>
⚠️ 保存する動画のファイル名は 学籍番号_cat_binary.mp4 としてください

</aside>

### ５.　音声の可視化（最大10点）

音声（report_audio.wav）には時間-周波数領域にメッセージが隠されています．

パラメータを適宜調節して解析し，可視化したグラフを描画してください．

### ６．動画の変わり目を検出する（最大25点）

動画（Detection.mp4）は４つの動画を結合したものです．

この動画から動画の変わり目（３つ）を以下の方法で自動で検出してください．

動画の変わり目は，前のフレームと比較をして**画素値の分布**の変化量が多いフレームといえます．

つまり，

1. 各フレームのヒストグラムを計算する
2. t 番目のフレームと t-1 番目のフレーム間のヒストグラムの相関を計算する

これらを全てのフレームに対して行い，相関が弱いフレームを見つけることで実現できます．

a. 横軸が時間（フレーム），縦軸が相関のグラフを描画してください（12点）．

b. 変化量がある値（閾値）よりも小さいフレームを動画の変わり目としたとき，何番目のフレームが動画の変わり目かを出力してください．閾値は自分で設定してかまいません．（12点）

定義はopenCVのcompareHist()を参考にすると良いと思います．

cf. [compareHist()](http://opencv.jp/opencv-2svn/cpp/imgproc_histograms.html)

考察の余地：

- ヒストグラムのbin
- 閾値
- 画素間の分布の変化量の尺度
    - KLダイバージェンス etc.

<aside>
⚠️ この課題ではcompareHist()やcalcHist()といったopenCVの関数は使用してはいけません．
numpy等で実装することを期待しています

</aside>

### ７．オブジェクト指向：Video クラスの作成（最大25点）

Videoクラスは 動画のpathを受け取り，インスタンス化する．

Videoクラスだけではなく，インスタンス化して動作を確認するプログラムもあわせて作成すること．

インスタンス変数として以下の４つを保持する：

- 動画の path
- タイトル
- ID
- サムネイル

コンストラクタ：

- 各変数を初期化

~~クラスメソッド~~ インスタンスメソッドとして以下の８つを用意する：

- サムネイルを作成するメソッドを作成
    - 課題２をクラス内のメソッドにする
    - サムネイルはインスタンス変数に代入
- ファイル名から特定の文字列（タイトルとID）を取り出すメソッドの作成
    - 課題３をクラス内のメソッドにする
    - タイトルとIDはインスタンス変数に代入
- ４つのインスタンス変数の値を取得する４つのメソッド（ゲッター）
    - get_title()
    - get_id()
    - get_thumbnail()
    - get_path()
- ２値化する動画を作成するメソッドの作成
    - 課題４をクラス内のメソッドにする
- ２値化する動画を作成するメソッドをフレームを処理する関数と動画処理を行う関数に分離し，引数としてフレームを処理する関数を受け取るように変更してください
    - cf. [高階関数](https://www.notion.so/1-Python-fa98e2f92db543c1b0a2f325d2abd760?pvs=21)
    
    （画像処理をする関数を増やしたとしても，その関数を渡すだけで動画処理ができるようにする）
    
    - 引数として受け取ったフレームに対して二値化する関数を作成
    - 引数として受け取ったフレームに対してグレースケール化する関数を作成
    - 上の２つの関数のどちらかを引数として受け取り，その関数が適用された動画を生成する関数を作成する

より良いと思う設計があれば適宜変更しても良いです（評価に含む）

その際は考察に書いてください

## 発展課題

発展課題への取り組みは自由です。

また、複数の発展課題から好きなものを選んで取り組んでも良いです。

以下の発展課題に取り組んだ場合、標準課題の点数に各項目の点数を上限として加点します。

１００点を超えても本課題の評定は１００点となります。

<aside>
⚠️ 発展課題は標準課題と同じノートブックに作成し提出してください

</aside>

### **a．バッチ処理**（最大4点）

ディレクトリのpathを指定し，そのディレクトリ内の全ての動画（People - 84973.mp4，Flowers - 66823.mp4，Dubrovnik - 12866.mp4，Cat - 66004.mp4）に対して標準課題の１～４の処理を行う 

<aside>
⚠️ ディレクトリ内の動画が任意のファイル名・ファイル数であっても対応できるのが望ましい

</aside>

### b**．**サムネイルの作成方法を工夫する（最大4点）

### c**．**その他の動画像処理（グレースケール，二値化以外）を行う（最大4点）

### d. 動画の変わり目を検出する方法の比較（最大8点)

課題6のヒストグラムの差分を利用した方法と**ピクセル間の差分を求める方法**を比較し，その結果を考察してください．

**ピクセル間の差分を求める方法**は以下：

動画の変わり目は，前のフレームと比較をして**画素値**の変化量が多いフレームといえます．

つまり，

1. グレースケールにする
2. t 番目のフレームと t-1 番目のフレームの各画素の差の絶対値を計算する
3. 全画素の差を足し合わせるZ（変化量）

これらを全てのフレームに対して行い，変化量が多いフレームを見つけることで実現できます．

定義はopenCVのabsdiff()を参考にすると良いと思います．

cf. [absdiff()](https://docs.opencv.org/3.4/d2/de8/group__core__array.html#ga6fef31bc8c4071cbc114a758a2b79c14)

## 提出締め切り

8月5日  午後 11時59分 （日本標準時：GMT+9）厳守

## 注意事項

<aside>
⚠️ ノートブックはコードセルとテキストセル（またはコメント）を適切に使用し，どのプログラムがどの課題に対応するのかわかりやすくしてください

</aside>

<aside>
⚠️ ファイル名：
学籍番号_final_report.pdf
学籍番号_final_exam.py / 学籍番号_final_exam.ipynb / 学籍番号_Cat_binary.mp4

例：1234567_final_exam.py

</aside>

<aside>
⚠️ zipなどで固めないで提出してください

</aside>

<aside>
⚠️ [ランタイム] → [すべてのセルを実行] を押したときに正常に動作することを確認してください

</aside>

<aside>
⚠️ 読み込む動画データのディレクトリのpathは以下にしてください

/content/drive/MyDrive/Colab Notebooks/dataset/videos

読み込む音声データのディレクトリのpathは以下にしてください

/content/drive/MyDrive/Colab Notebooks/dataset/audio

誤ると正しく評点がつけられない可能性があります

</aside>

<aside>
⚠️ 生成される動画のディレクトリのpathは以下にしてください

/content/drive/MyDrive/Colab Notebooks/dataset/videos/output

生成される画像のディレクトリのpathは以下にしてください

/content/drive/MyDrive/Colab Notebooks/dataset/images/output

誤ると正しく評点がつけられない可能性があります

</aside>

<aside>
⚠️ 成績反映の関係で締め切りは厳守でお願いします

</aside>

<aside>
⚠️ ライブラリの関数などを使用する場合はそのアルゴリズム・仕様等をレポートに記載してください

</aside>

- 課題の内容を正しく実現するプログラムを自分の力で作成すること。
- 演算結果が課題を満たしていれば、出力の見た目は問わない。
- 不正行為が発覚したときは、少なくとも本課題における評価が最低になる。留年の可能性もあるので、疑わしき行為もしないこと。
- 作成したプログラムだけでなく、レポートそのものも評価の対象
- そのうえで、工夫のあるものや、優れた考察をしたものには、よい評価を与える
- レポートとしての体裁が整っていることが、最低条件。
- レポートの作成にあたっては，「レポートの作成について」を参照し、これに合わせる。

---

# レポートの作成について

与えられた課題を満たすプログラムを自分の力で作成し，実際に実行して課題を満たしていることを確認する．その結果をまとめて，レポートを自分の力で作成する．

レポートは， TeX を用いて作成し，LETUSで提出する．

レポートは，以下の項目すべてについて，記述すること．

ただし，感想はなくてもよい．

## 表紙

氏名，学年，学籍番号，提出日，講義名，担当者名

これは，として，独立してつける．

## 課題

与えられた課題を書くこと．

## アルゴリズムの説明

課題を解くに当たって，どのようなアルゴリズムを基にプログラムを組んだか，その基となる考え方を順序だてて説明すること．アルゴリズムは, 基本的に, プログラミング言語には依存しない.

- ここでは，課題を解くためのアルゴリズムを示し，なぜこのアルゴリズムで課題が解けるのかを，理論的に解説する．
    
    > 例 (「a * b を実行する課題」の場合のアルゴリズムの説明の一部)a を b 倍することは，a を b 回足し合わせることと等価である．
    > 
- 複数のアルゴリズムを考えるなど試行錯誤した場合でも，ここでは，最終的に採用したアルゴリズムについてのみ解説する．
- アルゴリズムは，基本的に，プログラミング言語には依存しない．
- アルゴリズムの説明では，フローチャートを活用するのもよい方法である．(フローチャートは図なので，他に本文を必要とすることに注意．)

## プログラムの説明

先に述べたアルゴリズムを，実際にどのようにプログラムとして実現したかを，プログラムに沿って説明すること．たとえば, 各関数がどのような入出力をとり, どのような処理を行っているか, など.

- 先に述べたアルゴリズムを，実際にどのようにプログラムとして実現したかを，プログラムに沿って説明する．
- ここには，たとえば，各関数がどのような入出力をとり，どのような処理を行っているか，などを書くことになる．
    
    > 例 (「a * b を実行する課題」の場合のプログラムの説明の一部)    (前略)
        11  answer = 0;
        12  i = 0;
        13  while ( i < b ) {
        14      answer = answer + a;
        15      i = i + 1;
        16  }
        (後略)
        11 行目の answer は，計算結果を格納するための整数型変数である． 13 - 16 行目の while 文の中で，answer に a を足す動作を b 回行っている． この while 文では i が 0 から b - 1 まで 1 刻みで増加する間繰り返しを行うので， b 回の繰り返しを行うことになる． そのため，この while 文を抜ける時には，answer には a * b の値が格納されていることになる．(注: なぜ b 回の繰り返しで a * b になるかの理論的な説明は，既にアルゴリズムの説明の項で済んでいるので，繰り返し書く必要はない．)
    > 
- 複数のプログラムを作成するなど試行錯誤した場合でも，ここでは，最終的に採用したプログラムについてのみ解説する．

## 実行結果

実行結果をレポートに掲載してください．

細かい説明はここではせず, 次の「考察」に回す.

なお，実行結果は「出力結果そのもの」であることが重要であるため，添付する実行結果のファイルに行番号やファイル名を加えるなどの加工を施してはならない．

ただし，出力が大きくすべてを印刷するのは不適当であるなど，そのまま添付することが難しい場合には， (1) その旨明確に記すこと， (2) 省略など加工を加えた部分についても正しい結果が得られていることを証明すること，の必要性に留意の上，加工を加えてもよい．

- この項目では，掲載した実行結果を踏まえ，作成したプログラムが正しく動作していることを説明する．
- 実行結果は，あくまで結果の報告である．細かい説明はここではせず，次の「考察」に回す．

## 考察

実行結果についての考察のほか，アルゴリズム，プログラムについて，工夫した点などがあれば，ここに記述する．複数の手法を試した場合には，アルゴリズムまたはプログラムの説明の項目では最終的なもののみ記載し，ここでそれぞれの手法の比較を行う．考察は感想ではないことに注意．

- ここまでの項目が作成したシステムが課題を満たしていることを報告するためのものであるのに対し，考察は採用したアルゴリズムの優れている点，作成したプログラムの特徴，本課題を解くに当たって工夫した点など，「がんばったところ」「優れているところ」を主張するための項目である．したがって，レポートで最も重要なのは，考察の部分である．
- もちろん，考察内容は良いことばかりである必要はない．実行結果が芳しくなかったとしても，それに対して十分な検討を行い，立派な考察を書くことができれば，レポートは優れたものとなる．
- 考察では，まず，最終的に採用したプログラムについての記述を行う．アルゴリズムやプログラムの説明と内容が重複しないように注意．
    - 最終的に採用したアルゴリズムについての考察
    - 最終的に採用したプログラムについての考察
    - 最終的に採用したプログラムの実行結果についての考察
- 実行結果についての考察のほか，アルゴリズム，プログラムについて，工夫した点などがあれば，考察として記述する．
- 複数の手法を試した場合には，アルゴリズムまたはプログラムの説明の項目では最終的なもののみ記載し，考察でそれぞれの手法の説明および比較を行う．
- 考察は，各項目を別節に分けて記述すること．
    
    > 記述例 (これは節の記述の例なので，内容はこれと同じである必要はない．)5. 考察5.1 ABC アルゴリズムについて5.1.1. ABC アルゴリズムの特徴5.1.2. その他のソートアルゴリズムとの比較5.2 実行時間について5.2.1. プログラムの実行時間について5.2.2. ABC アルゴリズムの実行時間について5.2.3. ABC アルゴリズムと DE アルゴリズムの実行時間の比較
    > 
- レポートは「報告」であるため，原則として，時間の流れを追うような書き方はしない．(プログラムの処理の流れを追うことは別．)考察だけでなく，アルゴリズムの説明，プログラムの説明なども同様である．
- 考察は感想ではないことに注意．

## 感想

この項目はなくてもよい．この項目は評価の対象にならない．